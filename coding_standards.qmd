---
title: "R Coding Standards for Reproducibility"
format:
  revealjs:
    self-contained: true
    css: styles.css
    slide-number: true
execute:
  echo: true
  eval: false
  warning: false
  message: false
---

## What is `renv`?

- `renv` is an *R* package that helps make *R* projects **reproducible**
- It records:
  - Exact package versions used
  - Where packages came from (CRAN, Bioconductor, GitHub)
  - The *R* version used
- This allows collaborators, reviewers, and your future self to recreate the same *R* package environment on a different machine or at a later time

## How `renv` manages packages

- **Global package cache**:
  - Stores one copy of each package version on your machine
  - Shared across *R* projects for a given user
  - Can be configured to be shared across users on servers
- **Project library** (`renv/library/`):
  - Is project-specific and contains links to packages in the cache
  - Should never be committed to git

This design saves disk space and ensures isolation between projects.

## Use case 1: How to start using `renv` in an R project

1.  Run `install.packages("renv")`  
2.  `renv::init()` scans project files (`.R`, `.Rmd`, `.qmd`, `.Rnw`) for required packages and their dependencies. Then it
    - Creates the project library `renv/library/`
    - Installs required packages into the cache (`renv::paths$cache()` gives the cache path)
    - Writes the lockfile `renv.lock` that contains *R* and *R* package metadata recording the state of the project library (and used to reproduce project library by others or future self)
  
## Use case 1: How to start using `renv` in an R project
3. Commit `renv.lock` to git as the only `renv`-generated file
    - Note: if `.Rprofile` and `renv/activate.R` are also committed to git, `renv` will be automatically activated when the project is opened (on any machine)

## Use case 1: Maintaining `renv` after it was activated in an R project
- Use `renv::install("pkgname")` to install a new package or update an installed package
- After installing or updating one or multiple packages, use `renv::snapshot()` to update `renv.lock`

## Use case 2: Reproduce output in an R project that uses `renv` {.compact}
1. Open the project
2. Activate `renv`
    - If `.Rprofile` and `renv/activate.R` exist in the project folder, `renv` activates automatically (and installs if needed)
    - Otherwise, run `install.packages("renv")` and `renv::activate()`
    - Either activation---automatic or manual---creates a project library based on `renv.lock`
    - `renv::activate()` also adds `.Rprofile` and `renv/activate.R`
3. Run the analysis

## Use case 3: Collaborative code development in an R project that uses `renv`

Suppose `renv` is already activated (see previous slide).

- If a collaborator installs/updates a package(s), runs `renv::snapshot()`, and pushes a commit with an updated `renv.lock`, then call `renv::restore()` to sync your project library with the new `renv.lock`
- *Key idea:* `renv.lock` is the single source of truth

## Limitation of `renv`

- `renv` records the **R version** but does not install *R* for you
- Collaborators must install a compatible *R* version separately

## Key `renv` functions
- `renv::init()`
- `renv::activate()`
- `renv::install()`
- `renv::snapshot()`
- `renv::restore()`

## To learn more about `renv`
- Read **Introduction to renv**:<br> <https://rstudio.github.io/renv/articles/renv.html>
    
## Advanced notes
- If project includes *R* code that should be ignored by `renv`, add respective files/folders to `.renvignore` at the top level
    - E.g., add `dev/**` to ignore the folder `dev` and all its content
